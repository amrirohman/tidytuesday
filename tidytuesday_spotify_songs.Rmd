---
title: "Tidytuesday - Spotify Song"
author: "Amri Rohman"
date: "21/5/2020"
output: 
  html_document:
      code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      warning = FALSE,
                      message = FALSE,
                      fig.width=10,
                      fig.height=4)
options(scipen = 999,
        digits=2) 
```
# About Dataset
***

The data this week comes from Spotify via the [`spotifyr` package](https://www.rcharlie.com/spotifyr/). [Charlie Thompson](https://twitter.com/_RCharlie), [Josiah Parry](https://twitter.com/JosiahParry), Donal Phipps, and Tom Wolff authored this package to make it easier to get either your own data or general metadata arounds songs from Spotify's API. Make sure to check out the [`spotifyr` package](https://www.rcharlie.com/spotifyr/) website to see how you can collect your own data!

[Kaylin Pavlik](https://twitter.com/kaylinquest/status/1213138536570015745) had a recent [blogpost](https://www.kaylinpavlik.com/classifying-songs-genres/) using the audio features to explore and classify songs. She used the `spotifyr` package to collect about 5000 songs from 6 main categories (EDM, Latin, Pop, R&B, Rap, & Rock). 

[More Information About Dataset.](https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-01-21/readme.md)

# Loading Library and Data
***

```{r}
library(tidyverse)
library(janitor)
library(knitr)
library(skimr)

spotify_songs_raw <- read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-21/spotify_songs.csv')
```
I used several packages to help me do this task. That is Tidyverse, janitor, skimr and knitr

# Data Preparation
***

```{r}
spotify_songs <- spotify_songs_raw %>% 
  mutate(
    mode = case_when(mode == 1 ~ "major",
                     mode == 0 ~ "minor"),
    track_album_release_date = as.Date(track_album_release_date),
    year = as.numeric(format(track_album_release_date,'%Y')),
    era = case_when(year <= 2000 ~ "under 00s era",
                    year > 2000 & year <= 2010 ~ "2010 era",
                    year > 2010 ~ "modern era"),
    duration_s = duration_ms/60000) %>%
  select(-track_id, -track_album_id, -playlist_id)

spotify_songs %>% 
  select(track_name, track_artist, duration_s,
         track_popularity, playlist_genre, 
         tempo, era) %>%
  head() %>%
  kable()
```

# Summary
***
### Numeric Variable

```{r}
spotify_songs %>% 
  skim() %>%
  yank('numeric') %>% 
  select(-p0, -p25, -p75, -p100) %>%
  kable() 
```

### Character Variable

```{r}
spotify_songs %>% 
  skim() %>%
  yank('character') %>% 
  select(-whitespace, -empty) %>%
  kable() 
```

### Date Variable

```{r}
spotify_songs %>% 
  skim() %>%
  yank('Date') %>% 
  #select() %>%
  kable() 
```

# Data Exploration
***
### What song is the most popular?

```{r}
spotify_songs %>%
  select(track_name, track_artist, track_popularity) %>%
  arrange(-track_popularity) %>%
  distinct() %>%
  filter(track_popularity %in% c(97:100)) %>% 
  knitr::kable()
```

The first most popular song in Spotify is Dance Monkey	by Tones and I. Followed by ROXANNE	- Arizona Zervas and the others.

### How is the dominance of mode in every genre?

```{r}
spotify_songs %>%
  group_by(mode, playlist_genre) %>%
  count(mode, sort = TRUE) %>%
  ggplot() +
  geom_bar(aes(playlist_genre, n, fill=mode), position="fill", stat="identity") +
  geom_hline(aes(yintercept=0.5)) +
  coord_flip() +
  labs(x='Proportion', y='Playlist Genre') +
  theme_minimal()
```
Major mode is most often used in all genres on Spotify.

### How is the dominance of mode in every subgenre?
```{r}
spotify_songs %>%
  group_by(playlist_genre, mode) %>%
  count(playlist_subgenre) %>%
  ggplot() +
  geom_bar(aes(reorder(playlist_subgenre, n), n, fill=mode), position = 'stack', stat='identity') +
  coord_flip() +
  facet_wrap(playlist_genre~., scales="free", nrow=3) +
  theme_minimal() +
  theme(legend.position = 'bottom')
```
The sub genre of rock has the most dominant major modes than other sub genres. The sub genre of rap has a balanced mode relatively.

### Which track from the era is the most on Spotify?

```{r}
spotify_songs %>%
  group_by(era) %>%
  count(era, sort = TRUE) %>%
  na.omit() %>%
  ggplot(aes(era, y=n, fill=era)) +
  geom_bar(stat="identity") +
  labs(x='Era', y='Count') +
  theme_minimal()
```
Track from the modern era (released above in 2010) most in spotify.

### How the distribution of tempo in each genre?

```{r}
spotify_songs %>%
  group_by(playlist_genre, era) %>%
  na.omit() %>%
  ggplot() +
  geom_density(aes(tempo, fill=playlist_genre)) +
  facet_grid(era~playlist_genre) +
  labs(x='Tempo') +
  theme_minimal() +
  theme(legend.position = 'none')
```
Rap songs in the under 00s era had a slower tempo compared to other eras.

### How the distribution of duration in each genre?

```{r}
spotify_songs %>%
  na.omit(era) %>%
  ggplot() +
  geom_density(aes(duration_s, fill=playlist_genre)) +
  facet_grid(era~playlist_genre) +
  theme_minimal() +
  labs(x='Duration (sec)') +
  theme(legend.position = 'none')
```
EDM track in the 2010 era has a relatively longer duration than in other eras. Rap track in the modern era has a relatively shorter duration than in other eras. While others have relatively the same duration in each era.


